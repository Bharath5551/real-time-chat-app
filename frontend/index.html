<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Chat App</title>
  <style>
    body{font-family:Arial;margin:0;display:flex;height:100vh}
    .sidebar{width:20%;background:#1d4ed8;color:#fff;padding:16px;box-sizing:border-box}
    .chat{flex:1;display:flex;flex-direction:column}
    #chat-box{flex:1;padding:12px;overflow:auto;border-left:1px solid #ddd}
    .input{display:flex;padding:8px;border-top:1px solid #ddd}
    input{flex:1;padding:8px}
    button{padding:8px 12px;margin-left:8px}
    .message.user{background:#2563eb;color:#fff;padding:8px;border-radius:8px;margin:6px 0;text-align:right;max-width:70%;margin-left:auto}
    .message.other{background:#e5e7eb;padding:8px;border-radius:8px;margin:6px 0;max-width:70%}
    .system{color:#666;text-align:center;margin:8px 0;font-style:italic}
  </style>
</head>
<body>
  <div class="sidebar">
    <h3>Members</h3>
    <div id="membersList"></div>
  </div>

  <div class="chat">
    <div id="chat-box"></div>
    <div class="input">
      <input id="message" type="text" placeholder="Type message..." />
      <button id="sendBtn">Send</button>
    </div>
  </div>

  <!-- Socket.io CDN -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    // Connect to backend
    const socket = io("https://chat-real-kr4m.onrender.com", { transports: ["websocket"] });

    let username = prompt("Enter your username:") || "Guest";
    socket.emit("set-username", username);

    const sendBtn = document.getElementById("sendBtn");
    const messageInput = document.getElementById("message");

    function sendMessage() {
      const msg = messageInput.value.trim();
      if (!msg) return;
      socket.emit("chat-message", msg);
      messageInput.value = "";
    }

    sendBtn.addEventListener("click", sendMessage);
    messageInput.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });

    socket.on("chat-message", (data) => {
      const box = document.getElementById("chat-box");
      const div = document.createElement("div");
      div.className = data.userId === socket.id ? "message user" : "message other";
      div.textContent = `${data.username}: ${data.message}`;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    });

    socket.on("user-joined", data => addSystem(`${data.username} joined the chat`));
    socket.on("user-left", data => addSystem(`${data.username} left the chat`));

    socket.on("user update", users => {
      const members = document.getElementById("membersList");
      members.innerHTML = "";
      Object.values(users).forEach(name => {
        const d = document.createElement("div");
        d.textContent = name;
        members.appendChild(d);
      });
    });

    function addSystem(msg) {
      const box = document.getElementById("chat-box");
      const div = document.createElement("div");
      div.className = "system";
      div.textContent = msg;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }
  </script>
</body>
</html>
